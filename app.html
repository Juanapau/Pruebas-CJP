<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SCJP">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#5C6BC0">
    <meta name="msapplication-TileColor" content="#5C6BC0">
    <meta name="description" content="Sistema de gesti√≥n de calificaciones, actividades y asistencia para Centro Educativo SCJP">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Iconos para PWA -->
    <link rel="icon" type="image/png" sizes="32x32" href="icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152x152.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-120x120.png">
    
    <title>PNSA.SCJP</title>
    <link rel="stylesheet" href="styles.css">
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <!-- Indicador de cambios sin guardar -->
    <div id="indicadorCambios" class="cambios-sin-guardar">
        <span>‚ö†Ô∏è</span>
        <span>Hay cambios sin guardar</span>
    </div>

    <!-- Bot√≥n flotante para abrir men√∫ -->
    <button id="btnAbrirMenu" class="btn-menu-flotante" aria-label="Abrir men√∫">
        <span class="icono-menu">‚ò∞</span>
    </button>

    <!-- Overlay oscuro -->
    <div id="menuOverlay" class="menu-overlay"></div>

    <!-- Panel lateral del men√∫ -->
    <div id="menuLateral" class="menu-lateral">
        <div class="menu-header">
            <h2>üìã Men√∫ Principal</h2>
            <button id="btnCerrarMenu" class="btn-cerrar-menu" aria-label="Cerrar men√∫">‚úï</button>
        </div>

        <div class="menu-contenido">
            <!-- Modo oscuro/claro -->
            <div class="menu-seccion">
                <h3>‚öôÔ∏è Configuraci√≥n</h3>
                <button id="btnModoOscuroMenu" class="menu-item-config">
                    <span class="icono-config">
                        <span class="icono-sol-menu">‚òÄÔ∏è</span>
                        <span class="icono-luna-menu">üåô</span>
                    </span>
                    <span class="texto-config">Modo <span id="textoModo">Claro</span></span>
                    <span class="toggle-switch"></span>
                </button>
            </div>

            <!-- Separador -->
            <div class="menu-separador"></div>

            <!-- Navegaci√≥n -->
            <div class="menu-seccion">
                <h3>üìÇ Navegaci√≥n</h3>
                <button id="menuRegistroCalif" class="menu-item">
                    <span class="menu-icono">üìù</span>
                    <span class="menu-texto">Registro de Calificaciones</span>
                </button>
                <button id="menuRegistroAct" class="menu-item">
                    <span class="menu-icono">üìä</span>
                    <span class="menu-texto">Registro de Actividades</span>
                </button>
                <button id="menuRegistroAsist" class="menu-item">
                    <span class="menu-icono">üìã</span>
                    <span class="menu-texto">Registro de Asistencia</span>
                </button>
            </div>

            <!-- Footer del men√∫ -->
            <div class="menu-footer">
                <button id="btnSalir" class="menu-btn-salir" onclick="cerrarSesion()">
                    <span class="menu-salir-icono">‚èª</span>
                    <span>Cerrar sesi√≥n</span>
                </button>
                <p>Sistema SCJP v2.0</p>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Vista Principal: Registro de Calificaciones -->
        <div id="vistaRegistro" class="vista-principal">
            <div class="filtros-seccion-compacta">
                <h3 class="filtros-titulo-compacto">üìã Filtros de Selecci√≥n</h3>
                <div class="filtros-compactos-grid">
                    <div class="filtro-compacto">
                        <label>üéì Curso</label>
                        <select id="selectCurso">
                            <option value="">Seleccione un curso</option>
                            <option value="4toA">4toA</option>
                            <option value="4toB">4toB</option>
                            <option value="5toB">5toB</option>
                            <option value="6toB">6toB</option>
                        </select>
                    </div>

                    <div class="filtro-compacto">
                        <label>üìö M√≥dulo</label>
                        <select id="selectModulo">
                            <option value="">Seleccione un m√≥dulo</option>
                        </select>
                    </div>

                    <div class="filtro-compacto">
                        <label>üìä Actividades por RA</label>
                        <select id="selectRA">
                            <option value="">Seleccione un RA</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Tabla de Calificaciones por RA -->
            <div id="tablaRegistroContainer" class="tabla-container">
                <div class="tabla-header-con-boton">
                    <h2>Registro de Calificaciones - M√≥dulos</h2>
                    <div class="btns-tabla-acciones">
                        <button id="btnGuardarRegistro" class="btn-guardar">
                            üíæ Guardar
                        </button>
                        <button id="btnExportarPDF" class="btn-exportar-pdf" onclick="exportarReporteCalificaciones()">
                            üìÑ Exportar PDF
                        </button>
                    </div>
                </div>
                <div class="tabla-scroll" id="tablaScrollRegistro">
                    <!-- Botones de navegaci√≥n flotantes -->
                    <div class="scroll-nav-buttons scroll-nav-left">
                        <button class="scroll-nav-btn" id="scrollLeftRegistro" aria-label="Desplazar a la izquierda">
                            ‚óÄ
                        </button>
                    </div>
                    <div class="scroll-nav-buttons scroll-nav-right">
                        <button class="scroll-nav-btn" id="scrollRightRegistro" aria-label="Desplazar a la derecha">
                            ‚ñ∂
                        </button>
                    </div>
                    
                    <table id="tablaRegistro">
                        <thead id="tablaRegistroHead">
                            <!-- Se genera din√°micamente -->
                        </thead>
                        <tbody id="tablaRegistroBody">
                            <!-- Se genera din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Vista de Actividades por RA -->
        <div id="vistaActividades" class="vista-actividades" style="display: none;">
            <div class="ra-descripcion-box">
                <div class="ra-descripcion-header">
                    <h3>Descripci√≥n del RA</h3>
                    <button id="btnVolverRegistro" class="btn-volver-nuevo">‚Üê Volver a Registro</button>
                </div>
                <textarea id="raDescripcion" rows="2" placeholder="Descripci√≥n del Resultado de Aprendizaje..." class="ra-descripcion-textarea"></textarea>
                
                <!-- Filtros compactos para acceso directo -->
                <div class="filtros-actividades-compactos">
                    <div class="filtro-compacto">
                        <label>üéì Curso</label>
                        <select id="selectCursoActividades">
                            <option value="">Seleccione curso</option>
                            <option value="4toA">4toA</option>
                            <option value="4toB">4toB</option>
                            <option value="5toB">5toB</option>
                            <option value="6toB">6toB</option>
                        </select>
                    </div>
                    <div class="filtro-compacto">
                        <label>üìö M√≥dulo</label>
                        <select id="selectModuloActividades">
                            <option value="">Seleccione m√≥dulo</option>
                        </select>
                    </div>
                    <div class="filtro-compacto">
                        <label>üìä Actividades por RA</label>
                        <select id="selectRAActividades">
                            <option value="">Seleccione RA</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="tabla-container">
                <div class="tabla-header-con-boton">
                    <h2 id="tituloActividades">Actividades del RA</h2>
                    <button id="btnGuardarActividades" class="btn-guardar">
                        üíæ Guardar
                    </button>
                </div>
                <div class="tabla-scroll" id="tablaScrollActividades">
                    <!-- Botones de navegaci√≥n flotantes -->
                    <div class="scroll-nav-buttons scroll-nav-left">
                        <button class="scroll-nav-btn" id="scrollLeftActividades" aria-label="Desplazar a la izquierda">
                            ‚óÄ
                        </button>
                    </div>
                    <div class="scroll-nav-buttons scroll-nav-right">
                        <button class="scroll-nav-btn" id="scrollRightActividades" aria-label="Desplazar a la derecha">
                            ‚ñ∂
                        </button>
                    </div>
                    
                    <table id="tablaActividades">
                        <thead id="tablaActividadesHead">
                            <!-- Se genera din√°micamente -->
                        </thead>
                        <tbody id="tablaActividadesBody">
                            <!-- Se genera din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Vista de Asistencia -->
        <div id="vistaAsistencia" class="vista-asistencia" style="display: none;">
            <div class="tabla-header-con-boton">
                <h2>üìã Registro de Asistencia</h2>
                <div class="botones-asistencia">
                    <button id="btnVolverDesdeAsistencia" class="btn-volver-asistencia">
                        ‚Üê Volver
                    </button>
                    <button id="btnGuardarAsistencia" class="btn-guardar">
                        üíæ Guardar
                    </button>
                </div>
            </div>

            <!-- Filtros de asistencia compactos -->
            <div class="filtros-asistencia-compactos">
                <div class="filtro-compacto">
                    <label>üéì Curso</label>
                    <select id="selectCursoAsistencia">
                        <option value="">Seleccione un curso</option>
                        <option value="4toA">4toA</option>
                        <option value="4toB">4toB</option>
                        <option value="5toB">5toB</option>
                        <option value="6toB">6toB</option>
                    </select>
                </div>

                <div class="filtro-compacto">
                    <label>üìö M√≥dulo</label>
                    <select id="selectModuloAsistencia">
                        <option value="">Seleccione un m√≥dulo</option>
                    </select>
                </div>

                <div class="filtro-compacto">
                    <label>üìÖ Mes</label>
                    <input type="month" id="selectMesAsistencia" />
                </div>
            </div>

            <div class="leyenda-asistencia">
                <div class="leyenda-izquierda">
                    <strong>Leyenda de estados:</strong>
                    <div class="leyenda-items">
                        <div class="leyenda-item">
                            <div class="leyenda-cuadro estado-presente"></div>
                            <span>P = Presente</span>
                        </div>
                        <div class="leyenda-item">
                            <div class="leyenda-cuadro estado-excusa"></div>
                            <span>E = Excusa</span>
                        </div>
                        <div class="leyenda-item">
                            <div class="leyenda-cuadro estado-ausente"></div>
                            <span>A = Ausente</span>
                        </div>
                        <div class="leyenda-item">
                            <div class="leyenda-cuadro estado-feriado"></div>
                            <span>F = Feriado</span>
                        </div>
                    </div>
                    <div class="leyenda-nota">
                        Nota: 3 excusas = 1 ausencia. Se requiere 70% de asistencia.
                    </div>
                </div>
                
                <div class="resumen-dias-trabajados">
                    <span class="resumen-label-trabajados">D√≠as trabajados:</span>
                    <span class="resumen-numero-trabajados" id="diasTrabajados">0</span>
                </div>
            </div>

            <div class="tabla-scroll-container">
                <div class="scroll-nav-buttons scroll-nav-left">
                    <button class="scroll-nav-btn" id="scrollLeftAsistencia">‚óÄ</button>
                </div>
                <div class="scroll-nav-buttons scroll-nav-right">
                    <button class="scroll-nav-btn" id="scrollRightAsistencia">‚ñ∂</button>
                </div>

                <div id="tablaScrollAsistencia" class="tabla-scroll">
                    <table id="tablaAsistencia">
                        <thead id="tablaAsistenciaHead"></thead>
                        <tbody id="tablaAsistenciaBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="loading-card">
                <div class="spinner"></div>
                <p class="loading-texto">Cargando datos...</p>
                <p class="loading-subtexto" id="loadingSubtexto">Conectando con Google Sheets</p>
            </div>
        </div>
    </div>

    <!-- MODAL CONFIGURAR INSTRUMENTO -->
    <div id="modalConfigInstrumento" class="modal-instrumento" style="display: none;">
        <div class="modal-overlay-instrumento"></div>
        <div class="modal-contenido-instrumento">
            <div class="modal-header-instrumento">
                <h3>‚öôÔ∏è Configurar Instrumento de Evaluaci√≥n</h3>
                <button class="modal-close-instrumento" id="btnCerrarConfigInstrumento">‚úï</button>
            </div>
            
            <div class="modal-body-instrumento">
                <div class="config-info-actividad">
                    <div class="config-info-item">
                        <strong>M√≥dulo:</strong>
                        <span id="configModuloNombre">-</span>
                    </div>
                    <div class="config-info-item">
                        <strong>RA:</strong>
                        <span id="configRANombre">-</span>
                    </div>
                    <div class="config-info-item">
                        <strong>Actividad:</strong>
                        <span id="configActividadNum">-</span>
                    </div>
                </div>

                <div class="config-valor-section">
                    <label class="config-label-principal">
                        <span class="config-label-icono">üéØ</span>
                        <span>Valor de la Actividad</span>
                    </label>
                    <input type="number" id="configValorActividad" class="config-input-valor" 
                           placeholder="Ej: 2" min="0" step="0.1">
                    <span class="config-hint">Puede ser cualquier valor (0.5, 1, 2, 3, 10, etc.)</span>
                </div>

                <div class="config-instrumentos-section">
                    <label class="config-label-principal">
                        <span class="config-label-icono">üìã</span>
                        <span>Tipo de Instrumento</span>
                    </label>
                    
                    <div class="config-instrumentos-grid">
                        <div class="config-instrumento-card">
                            <input type="radio" name="tipoInstrumento" value="lista_cotejo" 
                                   id="radioListaCotejo" class="config-radio">
                            <label for="radioListaCotejo" class="config-card-content">
                                <div class="config-card-icon lista-cotejo-icon">‚úì</div>
                                <div class="config-card-titulo">Lista de Cotejo</div>
                                <div class="config-card-descripcion">Evaluaci√≥n S√≠/No por criterio</div>
                            </label>
                        </div>

                        <div class="config-instrumento-card">
                            <input type="radio" name="tipoInstrumento" value="rubrica" 
                                   id="radioRubrica" class="config-radio">
                            <label for="radioRubrica" class="config-card-content">
                                <div class="config-card-icon rubrica-icon">‚≠ê</div>
                                <div class="config-card-titulo">R√∫brica</div>
                                <div class="config-card-descripcion">Niveles de desempe√±o</div>
                            </label>
                        </div>

                        <div class="config-instrumento-card">
                            <input type="radio" name="tipoInstrumento" value="escala" 
                                   id="radioEscala" class="config-radio">
                            <label for="radioEscala" class="config-card-content">
                                <div class="config-card-icon escala-icon">üìä</div>
                                <div class="config-card-titulo">Escala</div>
                                <div class="config-card-descripcion">Valoraci√≥n num√©rica 1-5</div>
                            </label>
                        </div>

                        <div class="config-instrumento-card">
                            <input type="radio" name="tipoInstrumento" value="sin_instrumento" 
                                   id="radioSinInstrumento" class="config-radio" checked>
                            <label for="radioSinInstrumento" class="config-card-content">
                                <div class="config-card-icon sin-instrumento-icon">‚úèÔ∏è</div>
                                <div class="config-card-titulo">Sin Instrumento</div>
                                <div class="config-card-descripcion">Calificaci√≥n directa</div>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="config-criterios-section" id="configCriteriosSection" style="display: none;">
                    <div class="config-criterios-header">
                        <label class="config-label-principal">
                            <span class="config-label-icono">üìù</span>
                            <span>Criterios de Evaluaci√≥n</span>
                        </label>
                        <button type="button" class="btn-agregar-criterio" id="btnAgregarCriterio">
                            + Agregar Criterio
                        </button>
                    </div>

                    <div class="config-criterios-lista" id="configCriteriosLista">
                        <!-- Criterios se agregan din√°micamente -->
                    </div>

                    <div class="config-total-criterios">
                        <span>Total de puntos:</span>
                        <span class="total-puntos-numero" id="totalPuntosCriterios">0</span>
                    </div>
                </div>
            </div>

            <div class="modal-footer-instrumento">
                <button type="button" class="btn-modal-secundario" id="btnCancelarConfigInstrumento">
                    Cancelar
                </button>
                <button type="button" class="btn-modal-primario" id="btnGuardarConfigInstrumento">
                    üíæ Guardar Configuraci√≥n
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL EVALUAR CON INSTRUMENTO -->
    <div id="modalEvaluacion" class="modal-evaluacion" style="display: none;">
        <div class="modal-overlay-evaluacion"></div>
        <div class="modal-contenido-evaluacion">
            <div class="modal-header-evaluacion">
                <h3 id="tituloEvaluacion">üìã Evaluar Actividad</h3>
                <button class="modal-close-evaluacion" id="btnCerrarEvaluacion">‚úï</button>
            </div>
            
            <div class="modal-body-evaluacion">
                <div class="eval-info-panel">
                    <div class="eval-info-estudiante">
                        <div class="eval-avatar">üë§</div>
                        <div class="eval-estudiante-datos">
                            <div class="eval-nombre" id="evalNombreEstudiante">-</div>
                            <div class="eval-detalle" id="evalDetalleActividad">-</div>
                        </div>
                    </div>
                    <div class="eval-valor-total">
                        <span class="eval-label-valor">Valor:</span>
                        <span class="eval-numero-valor" id="evalValorActividad">0</span>
                        <span class="eval-label-pts">pts</span>
                    </div>
                </div>

                <div id="instrumentoListaCotejo" class="instrumento-contenedor" style="display: none;">
                    <div class="instrumento-header-tipo">
                        <div class="instrumento-icon-header lista-cotejo-icon">‚úì</div>
                        <div>
                            <div class="instrumento-titulo-tipo">Lista de Cotejo</div>
                            <div class="instrumento-descripcion-tipo">Marca los criterios cumplidos</div>
                        </div>
                    </div>
                    <div id="listaCriteriosCotejo" class="eval-criterios-lista"></div>
                </div>

                <div id="instrumentoRubrica" class="instrumento-contenedor" style="display: none;">
                    <div class="instrumento-header-tipo">
                        <div class="instrumento-icon-header rubrica-icon">‚≠ê</div>
                        <div>
                            <div class="instrumento-titulo-tipo">R√∫brica</div>
                            <div class="instrumento-descripcion-tipo">Selecciona el nivel de desempe√±o</div>
                        </div>
                    </div>
                    <div id="listaCriteriosRubrica" class="eval-criterios-lista"></div>
                </div>

                <div id="instrumentoEscala" class="instrumento-contenedor" style="display: none;">
                    <div class="instrumento-header-tipo">
                        <div class="instrumento-icon-header escala-icon">üìä</div>
                        <div>
                            <div class="instrumento-titulo-tipo">Escala de Valoraci√≥n</div>
                            <div class="instrumento-descripcion-tipo">Califica de 1 a 5</div>
                        </div>
                    </div>
                    <div id="listaCriteriosEscala" class="eval-criterios-lista"></div>
                </div>

                <div class="eval-resultado-panel">
                    <div class="eval-resultado-contenido">
                        <div class="eval-resultado-label">Calificaci√≥n obtenida:</div>
                        <div class="eval-resultado-calculo">
                            <span id="evalPuntosObtenidos">0</span>
                            <span class="eval-separator">/</span>
                            <span id="evalPuntosMaximos">0</span>
                            <span class="eval-multiply">√ó</span>
                            <span id="evalValorBase">0</span>
                            <span class="eval-equals">=</span>
                            <span class="eval-nota-final" id="evalNotaFinal">0.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer-evaluacion">
                <button type="button" class="btn-eval-secundario" id="btnCancelarEvaluacion">
                    Cancelar
                </button>
                <button type="button" class="btn-eval-primario" id="btnGuardarEvaluacion">
                    üíæ Guardar Evaluaci√≥n
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
